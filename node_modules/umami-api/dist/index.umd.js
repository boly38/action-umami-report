!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("axios")):"function"==typeof define&&define.amd?define(["axios"],r):(t||self).umamiApi=r(t.axios)}(this,function(t){function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=/*#__PURE__*/r(t);function e(){return e=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},e.apply(this,arguments)}var i=["1h","1hour","60min","60minutes"],o=["1d","1day","24h","24hours"],u=["7d","7days","1w","1week"],s=["31d","31days","1m","1month"],c=function(t){var r;if(void 0===t&&(t="24h"),i.includes(t))r=36e5;else if(o.includes(t))r=864e5;else if(u.includes(t))r=6048e5;else{if(!s.includes(t))throw"Unexpected period provided. Accepted values are : "+[].concat(i,o,u,s);r=26784e5}return{start_at:Date.now()-r,end_at:Date.now()}};function a(t,r){try{var n=t()}catch(t){return r(t)}return n&&n.then?n.then(void 0,r):n}var f="Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:102.0) Gecko/20100101 Firefox/102.0";function h(t,r,n){return n||(n="None specified"),n=JSON.stringify(n),r||(r="None specified"),r=r.toString(),new Error(t+"\nOptions: "+n+"\nStacktrace:"+r+"\n")}var d=/*#__PURE__*/function(){function t(t,r){this.t=void 0,this.id=void 0,this.websiteUuid=void 0,this.userId=void 0,this.name=void 0,this.domain=void 0,this.shareId=void 0,this.createdAt=void 0,this.t=t,Object.assign(this,r)}var r=t.prototype;return r.update=function(t){try{var r=this;return Promise.resolve(r.t.updateWebsite(r.websiteUuid,t)).then(function(t){return Object.assign(r,t),r})}catch(t){return Promise.reject(t)}},r.reset=function(){try{var t=this;return Promise.resolve(t.t.resetWebsite(t.websiteUuid)).then(function(){return t})}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.t.deleteWebsite(this.websiteUuid)).then(function(){})}catch(t){return Promise.reject(t)}},r.getStats=function(t){try{return Promise.resolve(this.t.getStats(this.websiteUuid,t))}catch(t){return Promise.reject(t)}},r.getPageviews=function(t){try{return Promise.resolve(this.t.getPageviews(this.websiteUuid,t))}catch(t){return Promise.reject(t)}},r.getEvents=function(t){try{return Promise.resolve(this.t.getEvents(this.websiteUuid,t))}catch(t){return Promise.reject(t)}},r.getMetrics=function(t){try{return Promise.resolve(this.t.getMetrics(this.websiteUuid,t))}catch(t){return Promise.reject(t)}},r.getActiveVisitors=function(){try{return Promise.resolve(this.t.getActiveVisitors(this.websiteUuid))}catch(t){return Promise.reject(t)}},t}(),m=/*#__PURE__*/function(){function t(t,r){this.t=void 0,this.id=void 0,this.username=void 0,this.isAdmin=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.accountUuid=void 0,this.t=t,Object.assign(this,r)}var r=t.prototype;return r.update=function(t){try{var r=this;return Promise.resolve(r.t.updateAccount(r.id,t)).then(function(t){return Object.assign(r,t),r})}catch(t){return Promise.reject(t)}},r.changePassword=function(t){try{var r=this;return Promise.resolve(r.t.changePassword(r.accountUuid,t)).then(function(){return r})}catch(t){return Promise.reject(t)}},r.deleteAccount=function(){try{return Promise.resolve(this.t.deleteAccount(this.id)).then(function(){})}catch(t){return Promise.reject(t)}},t}();/*#__PURE__*/
return function(){var t=r.prototype;function r(t,r,e,i){if(this.i=void 0,this.o=void 0,this.u=void 0,this.h=Date.now(),this.m="24h",this.v="hour",this.l="America/Toronto",this.P="url",this.p=f,!t)throw new Error("A server hostname is required");if(t=t.replace(/https?:\/\//,"").replace(/\/$/,""),!r||!e)throw new Error("A username and a password are required");this.u=i,this.i=n.default.create({baseURL:"https://"+t+"/api",timeout:this.getClientTimeoutMs()}),this.i.interceptors.request.use(this.C.bind(this)),this.o=this.i.post("/auth/login",{username:r,password:e}).catch(function(n){throw h("Login failed",n,{server:t,username:r})})}return t.setDefaultPeriod=function(t){this.m=t},t.setDefaultUnit=function(t){this.v=t},t.setDefaultTZ=function(t){this.l=t},t.setDefaultMetricType=function(t){this.P=t},t.setDefaultUserAgent=function(t){this.p=t},t.getCurrentUser=function(){try{return Promise.resolve(this.o).then(function(t){return t.data.user})}catch(t){return Promise.reject(t)}},t.getClientTimeoutMs=function(){var t=parseInt(process.env.UMAMI_CLIENT_TIMEOUT_MS||2e3.toString());return t<100||t>6e4?2e3:t},t.C=function(t){try{var r=this;return"/auth/login"==t.url||"/collect"==t.url?Promise.resolve(t):Promise.resolve(r.o).then(function(n){if(t.headers=e({},t.headers,{Authorization:"Bearer "+n.data.token}),"/auth/verify"==t.url)return t;var i=function(){if(r.h+36e5<Date.now())return r.h=Date.now(),a(function(){return Promise.resolve(r.i.get("/auth/verify")).then(function(){})},function(r){throw h("Could not verify authentication",r,{axiosConfig:t})})}();return i&&i.then?i.then(function(r){return t}):t})}catch(t){return Promise.reject(t)}},t.collect=function(t,r,n){try{var e=this;return void 0===n&&(n=e.p),Promise.resolve(a(function(){if(!n)throw new Error("A user agent is required. See https://umami.is/docs/api");return Promise.resolve(e.i.post("/collect",{type:t,payload:r},{headers:{"User-Agent":n}})).then(function(t){return t.data})},function(e){throw h("Could not collect",e,{type:t,payload:r,userAgent:n})}))}catch(t){return Promise.reject(t)}},r.collect=function(t,r,e,i){void 0===i&&(i=f);try{return t=t.replace(/https?:\/\//,"").replace(/\/$/,""),Promise.resolve(a(function(){if(!i)throw new Error("A user agent is required. See https://umami.is/docs/api");return Promise.resolve(n.default.post("https://"+t+"/api/collect",{type:r,payload:e},{headers:{"User-Agent":i}})).then(function(t){return t.data})},function(t){throw h("Could not collect",t,{type:r,payload:e,userAgent:i})}))}catch(t){return Promise.reject(t)}},t.createWebsite=function(t){try{var r=this;return Promise.resolve(a(function(){function n(){return Promise.resolve(r.i.post("/websites",t)).then(function(t){var n=t.data;return r.u?new d(r,n):n})}var i=function(){if(!t.owner)return Promise.resolve(r.getCurrentUser()).then(function(r){t=e({},t,{owner:r.userId})})}();return i&&i.then?i.then(n):n()},function(r){throw h("Could not create website",r,{options:t})}))}catch(t){return Promise.reject(t)}},t.updateWebsite=function(t,r){try{var n=this;return Promise.resolve(a(function(){function i(){return Promise.resolve(n.i.post("/websites/"+t,r)).then(function(t){var r=t.data;return n.u?new d(n,r):r})}var o=function(){if(!r.owner)return Promise.resolve(n.getCurrentUser()).then(function(t){r=e({},r,{owner:t.userId})})}();return o&&o.then?o.then(i):i()},function(n){throw h("Could not update website",n,{websiteUuid:t,options:r})}))}catch(t){return Promise.reject(t)}},t.getWebsite=function(t){void 0===t&&(t=null);try{var r,n=this;return Promise.resolve(a(function(){function e(e){return r?e:Promise.resolve(n.i.get("/websites/"+t)).then(function(t){var r=t.data;return n.u?new d(n,r):r})}var i=function(){if(null==t)return Promise.resolve(n.getWebsites()).then(function(t){if(n.u){var e=new d(n,t[0]);return r=1,e}return r=1,t[0]})}();return i&&i.then?i.then(e):e(i)},function(r){throw h("Could not get website",r,{websiteUuid:t})}))}catch(t){return Promise.reject(t)}},t.getWebsiteBy=function(t,r){try{var n,e=function(e){var o;if(n)return e;function u(n){return o?n:Promise.resolve(i.getWebsites()).then(function(n){var e=n.find(function(n){return n[t]==r});if(!e)throw h("Could not find website",null,{key:t,value:r});return i.u?new d(i,e):e})}var s=function(){if("websiteUuid"==t)return a(function(){return Promise.resolve(i.getWebsite(r)).then(function(t){if(i.u){var r=new d(i,t);return o=1,r}return o=1,t})},function(n){throw h("Could not find website",n,{key:t,value:r})})}();return s&&s.then?s.then(u):u(s)},i=this,o=function(){if("shareId"==t)return a(function(){return Promise.resolve(i.i.get("/share/"+r)).then(function(t){return Promise.resolve(i.getWebsite(t.data.websiteId)).then(function(t){if(i.u){var r=new d(i,t);return n=1,r}return n=1,t})})},function(n){throw h("Could not find website",n,{key:t,value:r})})}();return Promise.resolve(o&&o.then?o.then(e):e(o))}catch(t){return Promise.reject(t)}},t.resetWebsite=function(t){try{var r=this;return Promise.resolve(a(function(){return Promise.resolve(r.i.post("/websites/"+t+"/reset")).then(function(t){var n=t.data;return r.u?new d(r,n):n})},function(r){throw h("Could not reset website",r,{websiteUuid:t})}))}catch(t){return Promise.reject(t)}},t.deleteWebsite=function(t){try{var r=this;return Promise.resolve(a(function(){return Promise.resolve(r.i.delete("/websites/"+t)).then(function(){})},function(r){throw h("Could not delete website",r,{websiteUuid:t})}))}catch(t){return Promise.reject(t)}},t.getWebsites=function(t){try{var r=this;return Promise.resolve(a(function(){return Promise.resolve(r.i.get("/websites",{params:t})).then(function(t){var n=t.data;return r.u?n.map(function(t){return new d(r,t)}):n})},function(r){throw h("Could not get websites",r,{options:t})}))}catch(t){return Promise.reject(t)}},t.getStats=function(t,r){try{var n,i=this,o=c(null!=(n=null==r?void 0:r.period)?n:i.m),u=e({},r,{start_at:o.start_at,end_at:o.end_at});return Promise.resolve(a(function(){return Promise.resolve(i.i.get("/websites/"+t+"/stats",{params:u})).then(function(t){return t.data})},function(r){throw h("Could not get stats",r,{websiteUuid:t,params:u})}))}catch(t){return Promise.reject(t)}},t.getPageviews=function(t,r){try{var n,i,o,u=this,s=c(null!=(n=null==r?void 0:r.period)?n:u.m),f=e({},r,{start_at:s.start_at,end_at:s.end_at,unit:null!=(i=null==r?void 0:r.unit)?i:u.v,tz:null!=(o=null==r?void 0:r.tz)?o:u.l});return Promise.resolve(a(function(){return Promise.resolve(u.i.get("/websites/"+t+"/pageviews",{params:f})).then(function(t){return t.data})},function(r){throw h("Could not get pageviews",r,{websiteUuid:t,params:f})}))}catch(t){return Promise.reject(t)}},t.getEvents=function(t,r){try{var n,e,i,o=this,u=c(null!=(n=null==r?void 0:r.period)?n:o.m),s={start_at:u.start_at,end_at:u.end_at,unit:null!=(e=null==r?void 0:r.unit)?e:o.v,tz:null!=(i=null==r?void 0:r.tz)?i:o.l,url:null==r?void 0:r.url,event_name:null==r?void 0:r.event_name};return Promise.resolve(a(function(){return Promise.resolve(o.i.get("/websites/"+t+"/events",{params:s})).then(function(t){return t.data})},function(r){throw h("Could not get events",r,{websiteUuid:t,params:s})}))}catch(t){return Promise.reject(t)}},t.getMetrics=function(t,r){try{var n,i,o=this,u=c(null!=(n=null==r?void 0:r.period)?n:o.m),s=e({},r,{start_at:u.start_at,end_at:u.end_at,type:null!=(i=null==r?void 0:r.type)?i:o.P});return Promise.resolve(a(function(){return Promise.resolve(o.i.get("/websites/"+t+"/metrics",{params:s})).then(function(t){return t.data})},function(r){throw h("Could not get metrics",r,{websiteUuid:t,params:s})}))}catch(t){return Promise.reject(t)}},t.getActiveVisitors=function(t){try{var r=this;return Promise.resolve(a(function(){return Promise.resolve(r.i.get("/websites/"+t+"/active")).then(function(t){return t.data})},function(r){throw h("Could not get active visitors",r,{websiteUuid:t})}))}catch(t){return Promise.reject(t)}},t.createAccount=function(t){try{var r=this;return Promise.resolve(a(function(){return Promise.resolve(r.i.post("/accounts",t)).then(function(t){var n=t.data;return r.u?new m(r,n):n})},function(r){throw h("Could not create account",r,{options:t})}))}catch(t){return Promise.reject(t)}},t.updateAccount=function(t,r){try{var n=this;return Promise.resolve(a(function(){return Promise.resolve(n.i.post("/accounts/"+t,r)).then(function(t){var r=t.data;return n.u?new m(n,r):r})},function(n){throw h("Could not update account",n,{userId:t,options:r})}))}catch(t){return Promise.reject(t)}},t.changePassword=function(t,r){try{var n=this;return Promise.resolve(a(function(){return Promise.resolve(n.i.post("/accounts/"+t+"/password",r)).then(function(t){var r=t.data;return n.u?new m(n,r):r})},function(n){throw h("Could not update password",n,{accountUuid:t,options:r})}))}catch(t){return Promise.reject(t)}},t.getAccounts=function(){try{var t=this;return Promise.resolve(a(function(){return Promise.resolve(t.i.get("/accounts")).then(function(r){var n=r.data;return t.u?n.map(function(r){return new m(t,r)}):n})},function(t){throw h("Could not get accounts",t)}))}catch(t){return Promise.reject(t)}},t.getAccount=function(t){try{var r=this;return Promise.resolve(a(function(){return Promise.resolve(r.i.get("/accounts/"+t)).then(function(t){var n=t.data;return r.u?new m(r,n):n})},function(r){throw h("Could not get account",r,{userId:t})}))}catch(t){return Promise.reject(t)}},t.deleteAccount=function(t){try{var r=this;return Promise.resolve(a(function(){return Promise.resolve(r.i.delete("/accounts/"+t)).then(function(){})},function(r){throw h("Could not delete account",r,{userId:t})}))}catch(t){return Promise.reject(t)}},r}()});
//# sourceMappingURL=index.umd.js.map
