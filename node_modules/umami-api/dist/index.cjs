"use strict";var I=Object.create;var l=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var M=(i,e)=>{for(var t in e)l(i,t,{get:e[t],enumerable:!0})},_=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of P(e))!D.call(i,s)&&s!==t&&l(i,s,{get:()=>e[s],enumerable:!(r=f(e,s))||r.enumerable});return i};var p=(i,e,t)=>(t=i!=null?I(v(i)):{},_(e||!i||!i.__esModule?l(t,"default",{value:i,enumerable:!0}):t,i)),C=i=>_(l({},"__esModule",{value:!0}),i);var H={};M(H,{default:()=>N});module.exports=C(H);var w=p(require("axios"),1);var{UMAMI_CLIENT_TIMEOUT_MS:y,UMAMI_CLIENT_USER_AGENT:R,UMAMI_CLIENT_TIME_PERIOD:O,UMAMI_CLIENT_TIME_UNIT:W,UMAMI_CLIENT_TIMEZONE:S,UMAMI_CLIENT_METRIC_TYPE:L}=process.env,A=y?parseInt(y):2e3,h=R??"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:102.0) Gecko/20100101 Firefox/102.0",u=O??"24h",b=W??"hour",m=S??"America/Toronto",x=L??"url";var E=["1h","1hour","60min","60minutes"],o=["1d","1day","24h","24hours"],U=["7d","7days","1w","1week"],T=["31d","31days","1m","1month"],g=(i="24h")=>{let e;if(E.includes(i))e=60*60*1e3;else if(o.includes(i))e=24*60*60*1e3;else if(U.includes(i))e=7*24*60*60*1e3;else if(T.includes(i))e=31*24*60*60*1e3;else throw`Unexpected period provided. Accepted values are : ${[...E,...o,...U,...T]}`;return{start_at:Date.now()-e,end_at:Date.now()}},a=class{_apiClient;_axios;id;websiteUuid;userId;name;domain;shareId;createdAt;constructor(e,t,r){this._apiClient=e,this._axios=t,this.id=r.id,this.websiteUuid=r.websiteUuid,this.userId=r.userId,this.name=r.name,this.domain=r.domain,this.shareId=r.shareId,this.createdAt=r.createdAt}async update(e){if(!e.owner){let r=await this._apiClient.getCurrentUser();e={...e,owner:r.userId}}let{data:t}=await this._axios.post(`/websites/${this.websiteUuid}`,e);return Object.assign(this,t),this}async delete(){await this._axios.delete(`/websites/${this.websiteUuid}`)}async getStats(e){let{data:t}=await this._axios.get(`/websites/${this.websiteUuid}/stats`,{params:{...g((e==null?void 0:e.period)??u),url:e==null?void 0:e.url,referrer:e==null?void 0:e.referrer,os:e==null?void 0:e.os,browser:e==null?void 0:e.browser,device:e==null?void 0:e.device,country:e==null?void 0:e.country}});return t}async resetStats(){return await this._axios.post(`/websites/${this.websiteUuid}/reset`),this}async getPageviews(e){let{data:t}=await this._axios.get(`/websites/${this.websiteUuid}/pageviews`,{params:{...g((e==null?void 0:e.period)??u),unit:(e==null?void 0:e.unit)??b,tz:(e==null?void 0:e.tz)??m,url:e==null?void 0:e.url,referrer:e==null?void 0:e.referrer,os:e==null?void 0:e.os,browser:e==null?void 0:e.browser,device:e==null?void 0:e.device,country:e==null?void 0:e.country}});return t}async getEvents(e){let{data:t}=await this._axios.get(`/websites/${this.websiteUuid}/events`,{params:{...g((e==null?void 0:e.period)??u),unit:(e==null?void 0:e.unit)??b,tz:(e==null?void 0:e.tz)??m,url:e==null?void 0:e.url,event_type:e==null?void 0:e.event_type}});return t}async getMetrics(e){let{data:t}=await this._axios.get(`/websites/${this.websiteUuid}/metrics`,{params:{...g((e==null?void 0:e.period)??u),type:(e==null?void 0:e.type)??x,url:e==null?void 0:e.url,referrer:e==null?void 0:e.referrer,os:e==null?void 0:e.os,browser:e==null?void 0:e.browser,device:e==null?void 0:e.device,country:e==null?void 0:e.country}});return t}async getActiveVisitors(){let{data:e}=await this._axios.get(`/websites/${this.websiteUuid}/active`);return e}};var n=class{_axios;id;username;isAdmin;createdAt;updatedAt;accountUuid;constructor(e,t){this._axios=e,this.id=t.id,this.username=t.username,this.isAdmin=t.isAdmin,this.createdAt=t.createdAt,this.updatedAt=t.updatedAt,this.accountUuid=t.accountUuid}async update(e){let{data:t}=await this._axios.post(`/accounts/${this.id}`,e);return Object.assign(this,t),this}async changePassword(e){return await this._axios.post(`/accounts/${this.accountUuid}/password`,e),this}async delete(){await this._axios.delete(`/accounts/${this.id}`)}};function $(i){return!!i&&!Object.hasOwn(i,"common")}var d=class{_axios;_auth;_lastAuthCheck=Date.now();async getCurrentUser(){return(await this._auth).data.user}constructor(e,t,r){if(!e)throw new Error("A server hostname is required");if(e=e.replace(/https?:\/\//,"").replace(/\/$/,""),!t||!r)throw new Error("A username and a password are required");this._axios=w.default.create({baseURL:`https://${e}/api`,timeout:A}),this._axios.interceptors.request.use(this._verifyAuth.bind(this)),this._auth=this._axios.post("/auth/login",{username:t,password:r})}async _verifyAuth(e){if(e.url=="/auth/login"||e.url=="/collect")return e;let t=await this._auth;if($(e.headers)&&e.headers.set("Authorization",`Bearer ${t.data.token}`),e.url=="/auth/verify")return e;if(this._lastAuthCheck+60*60*1e3<Date.now()){this._lastAuthCheck=Date.now();try{await this._axios.get("/auth/verify")}catch(r){throw console.error({axiosConfig:e}),r}}return e}async collect(e,t,r=h){if(!r)throw new Error("A user agent is required. See https://umami.is/docs/api");let{data:s}=await this._axios.post("/collect",{type:e,payload:t},{headers:{"User-Agent":r}});return s}static async collect(e,t,r,s=h){if(!e)throw new Error("A server is required.");if(e=e.replace(/https?:\/\//,"").replace(/\/$/,""),!s)throw new Error("A user agent is required. See https://umami.is/docs/api");let{data:c}=await w.default.post(`https://${e}/api/collect`,{type:t,payload:r},{headers:{"User-Agent":s}});return c}async getWebsites(e){let{data:t}=await this._axios.get("/websites",{params:e});return t.map(r=>new a(this,this._axios,r))}async getWebsite(e){if(e===void 0){let r=await this.getWebsites();return new a(this,this._axios,r[0])}let{data:t}=await this._axios.get(`/websites/${e}`);return new a(this,this._axios,t)}async getWebsiteBy(e,t){if(e=="shareId"){let{data:c}=await this._axios.get(`/share/${t}`);return await this.getWebsite(c.id)}if(e=="websiteUuid")return await this.getWebsite(t);let s=(await this.getWebsites()).find(c=>c[e]==t);if(!s)throw Error("Could not find website");return s}async createWebsite(e){if(!e.owner){let r=await this.getCurrentUser();e={...e,owner:r.userId}}let{data:t}=await this._axios.post("/websites",e);return new a(this,this._axios,t)}async getAccounts(){let{data:e}=await this._axios.get("/accounts");return e.map(t=>new n(this._axios,t))}async getAccount(e){let{data:t}=await this._axios.get(`/accounts/${e}`);return new n(this._axios,t)}async createAccount(e){let{data:t}=await this._axios.post("/accounts",e);return new n(this._axios,t)}};var N=d;0&&(module.exports={});
//# sourceMappingURL=index.cjs.map