function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=/*#__PURE__*/t(require("axios"));function n(){return n=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},n.apply(this,arguments)}var e=["1h","1hour","60min","60minutes"],i=["1d","1day","24h","24hours"],o=["7d","7days","1w","1week"],u=["31d","31days","1m","1month"],s=function(t){var r;if(void 0===t&&(t="24h"),e.includes(t))r=36e5;else if(i.includes(t))r=864e5;else if(o.includes(t))r=6048e5;else{if(!u.includes(t))throw"Unexpected period provided. Accepted values are : "+[].concat(e,i,o,u);r=26784e5}return{start_at:Date.now()-r,end_at:Date.now()}};function c(t,r){try{var n=t()}catch(t){return r(t)}return n&&n.then?n.then(void 0,r):n}var a="Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:102.0) Gecko/20100101 Firefox/102.0";function f(t,r,n){return n||(n="None specified"),n=JSON.stringify(n),r||(r="None specified"),r=r.toString(),new Error(t+"\nOptions: "+n+"\nStacktrace:"+r+"\n")}var h=/*#__PURE__*/function(){function t(t,r){this.t=void 0,this.website_id=void 0,this.website_uuid=void 0,this.user_id=void 0,this.name=void 0,this.domain=void 0,this.share_id=void 0,this.created_at=void 0,this.t=t,Object.assign(this,r)}var r=t.prototype;return r.update=function(t){try{var r=this;return Promise.resolve(r.t.updateWebsite(r.website_id,t)).then(function(t){return Object.assign(r,t),r})}catch(t){return Promise.reject(t)}},r.reset=function(){try{var t=this;return Promise.resolve(t.t.resetWebsite(t.website_id)).then(function(){return t})}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.t.deleteWebsite(this.website_id)).then(function(){})}catch(t){return Promise.reject(t)}},r.getStats=function(t){try{return Promise.resolve(this.t.getStats(this.website_id,t))}catch(t){return Promise.reject(t)}},r.getPageviews=function(t){try{return Promise.resolve(this.t.getPageviews(this.website_id,t))}catch(t){return Promise.reject(t)}},r.getEvents=function(t){try{return Promise.resolve(this.t.getEvents(this.website_id,t))}catch(t){return Promise.reject(t)}},r.getEventsByName=function(t,r){try{return Promise.resolve(this.t.getEventsByName(this.website_id,t,r))}catch(t){return Promise.reject(t)}},r.getMetrics=function(t){try{return Promise.resolve(this.t.getMetrics(this.website_id,t))}catch(t){return Promise.reject(t)}},r.getActiveVisitors=function(){try{return Promise.resolve(this.t.getActiveVisitors(this.website_id))}catch(t){return Promise.reject(t)}},t}(),d=/*#__PURE__*/function(){function t(t,r){this.t=void 0,this.user_id=void 0,this.username=void 0,this.is_admin=void 0,this.created_at=void 0,this.updated_at=void 0,this.t=t,Object.assign(this,r)}var r=t.prototype;return r.update=function(t){try{var r=this;return Promise.resolve(r.t.updateAccount(r.user_id,t)).then(function(t){return Object.assign(r,t),r})}catch(t){return Promise.reject(t)}},r.changePassword=function(t){try{var r=this;return Promise.resolve(r.t.changePassword(r.user_id,t)).then(function(){return r})}catch(t){return Promise.reject(t)}},r.deleteAccount=function(){try{return Promise.resolve(this.t.deleteAccount(this.user_id)).then(function(){})}catch(t){return Promise.reject(t)}},t}();module.exports=/*#__PURE__*/function(){var t=e.prototype;function e(t,n,e,i){if(this.i=void 0,this.o=void 0,this.u=void 0,this.h=Date.now(),this.m="24h",this.l="hour",this.v="America/Toronto",this.P="url",this.p=a,!t)throw new Error("A server hostname is required");if(t=t.replace(/https?:\/\//,"").replace(/\/$/,""),!n||!e)throw new Error("A username and a password are required");this.u=i,this.i=r.default.create({baseURL:"https://"+t+"/api",timeout:1e3}),this.i.interceptors.request.use(this._.bind(this)),this.o=this.i.post("/auth/login",{username:n,password:e}).catch(function(r){throw f("Login failed",r,{server:t,username:n})})}return t.setDefaultPeriod=function(t){this.m=t},t.setDefaultUnit=function(t){this.l=t},t.setDefaultTZ=function(t){this.v=t},t.setDefaultMetricType=function(t){this.P=t},t.setDefaultUserAgent=function(t){this.p=t},t.getCurrentUser=function(){try{return Promise.resolve(this.o).then(function(t){return t.data.user})}catch(t){return Promise.reject(t)}},t._=function(t){try{var r=this;return"/auth/login"==t.url||"/collect"==t.url?Promise.resolve(t):Promise.resolve(r.o).then(function(e){if(t.headers=n({},t.headers,{Authorization:"Bearer "+e.data.token}),"/auth/verify"==t.url)return t;var i=function(){if(r.h+36e5<Date.now())return r.h=Date.now(),c(function(){return Promise.resolve(r.i.get("/auth/verify")).then(function(){})},function(r){throw f("Could not verify authentication",r,{axiosConfig:t})})}();return i&&i.then?i.then(function(r){return t}):t})}catch(t){return Promise.reject(t)}},t.collect=function(t,r,n){try{var e=this;return void 0===n&&(n=e.p),Promise.resolve(c(function(){if(!n)throw new Error("A user agent is required. See https://umami.is/docs/api");return Promise.resolve(e.i.post("/collect",{type:t,payload:r},{headers:{"User-Agent":n}})).then(function(t){return t.data})},function(e){throw f("Could not collect",e,{type:t,payload:r,userAgent:n})}))}catch(t){return Promise.reject(t)}},e.collect=function(t,n,e,i){void 0===i&&(i=a);try{return t=t.replace(/https?:\/\//,"").replace(/\/$/,""),Promise.resolve(c(function(){if(!i)throw new Error("A user agent is required. See https://umami.is/docs/api");return Promise.resolve(r.default.post("https://"+t+"/api/collect",{type:n,payload:e},{headers:{"User-Agent":i}})).then(function(t){return t.data})},function(t){throw f("Could not collect",t,{type:n,payload:e,userAgent:i})}))}catch(t){return Promise.reject(t)}},t.createWebsite=function(t){try{var r=this;return Promise.resolve(c(function(){return Promise.resolve(r.i.post("/website",t)).then(function(t){var n=t.data;return r.u?new h(r,n):n})},function(r){throw f("Could not create website",r,{options:t})}))}catch(t){return Promise.reject(t)}},t.updateWebsite=function(t,r){try{var e=this;return Promise.resolve(c(function(){return Promise.resolve(e.i.post("/website",n({website_id:t},r))).then(function(t){var r=t.data;return e.u?new h(e,r):r})},function(n){throw f("Could not update website",n,{website_id:t,options:r})}))}catch(t){return Promise.reject(t)}},t.getWebsite=function(t){void 0===t&&(t=null);try{var r,n=this;return Promise.resolve(c(function(){function e(e){return r?e:Promise.resolve(n.i.get("/website/"+t)).then(function(t){var r=t.data;return n.u?new h(n,r):r})}var i=function(){if(null==t)return Promise.resolve(n.getWebsites()).then(function(t){if(n.u){var e=new h(n,t[0]);return r=1,e}return r=1,t[0]})}();return i&&i.then?i.then(e):e(i)},function(r){throw f("Could not get website",r,{website_id:t})}))}catch(t){return Promise.reject(t)}},t.getWebsiteBy=function(t,r){try{var n,e=function(e){var o;if(n)return e;function u(n){return o?n:Promise.resolve(i.getWebsites()).then(function(n){var e=n.find(function(n){return n[t]==r});if(!e)throw f("Could not find website",null,{key:t,value:r});return i.u?new h(i,e):e})}var s=function(){if("website_id"==t)return c(function(){return Promise.resolve(i.getWebsite(r)).then(function(t){if(i.u){var r=new h(i,t);return o=1,r}return o=1,t})},function(n){throw f("Could not find website",n,{key:t,value:r})})}();return s&&s.then?s.then(u):u(s)},i=this,o=function(){if("share_id"==t)return c(function(){return Promise.resolve(i.i.get("/share/"+r)).then(function(t){return Promise.resolve(i.getWebsite(t.data.websiteId)).then(function(t){if(i.u){var r=new h(i,t);return n=1,r}return n=1,t})})},function(n){throw f("Could not find website",n,{key:t,value:r})})}();return Promise.resolve(o&&o.then?o.then(e):e(o))}catch(t){return Promise.reject(t)}},t.resetWebsite=function(t){try{var r=this;return Promise.resolve(c(function(){return Promise.resolve(r.i.post("/website/"+t+"/reset")).then(function(t){var n=t.data;return r.u?new h(r,n):n})},function(r){throw f("Could not reset website",r,{website_id:t})}))}catch(t){return Promise.reject(t)}},t.deleteWebsite=function(t){try{var r=this;return Promise.resolve(c(function(){return Promise.resolve(r.i.delete("/website/"+t)).then(function(){})},function(r){throw f("Could not delete website",r,{website_id:t})}))}catch(t){return Promise.reject(t)}},t.getWebsites=function(t){try{var r=this;return Promise.resolve(c(function(){return Promise.resolve(r.i.get("/websites",{params:t})).then(function(t){var n=t.data;return r.u?n.map(function(t){return new h(r,t)}):n})},function(r){throw f("Could not get websites",r,{options:t})}))}catch(t){return Promise.reject(t)}},t.getStats=function(t,r){try{var e,i=this,o=s(null!=(e=null==r?void 0:r.period)?e:i.m),u=n({},r,{start_at:o.start_at,end_at:o.end_at});return Promise.resolve(c(function(){return Promise.resolve(i.i.get("/website/"+t+"/stats",{params:u})).then(function(t){return t.data})},function(r){throw f("Could not get stats",r,{website_id:t,params:u})}))}catch(t){return Promise.reject(t)}},t.getPageviews=function(t,r){try{var e,i,o,u=this,a=s(null!=(e=null==r?void 0:r.period)?e:u.m),h=n({},r,{start_at:a.start_at,end_at:a.end_at,unit:null!=(i=null==r?void 0:r.unit)?i:u.l,tz:null!=(o=null==r?void 0:r.tz)?o:u.v});return Promise.resolve(c(function(){return Promise.resolve(u.i.get("/website/"+t+"/pageviews",{params:h})).then(function(t){return t.data})},function(r){throw f("Could not get pageviews",r,{website_id:t,params:h})}))}catch(t){return Promise.reject(t)}},t.getEvents=function(t,r){try{var n,e,i,o=this,u=s(null!=(n=null==r?void 0:r.period)?n:o.m),a={start_at:u.start_at,end_at:u.end_at,unit:null!=(e=null==r?void 0:r.unit)?e:o.l,tz:null!=(i=null==r?void 0:r.tz)?i:o.v,url:null==r?void 0:r.url,event_type:null==r?void 0:r.event_type};return Promise.resolve(c(function(){return Promise.resolve(o.i.get("/website/"+t+"/events",{params:a})).then(function(t){return t.data})},function(r){throw f("Could not get events",r,{website_id:t,params:a})}))}catch(t){return Promise.reject(t)}},t.getEventsByName=function(t,r,n){try{var e=this;return Promise.resolve(c(function(){return Promise.resolve(e.getEvents(t,{period:null==n?void 0:n.period,unit:null==n?void 0:n.unit,tz:null==n?void 0:n.tz,url:null==n?void 0:n.url,event_type:null==n?void 0:n.event_type})).then(function(t){return t.filter(function(t){return t.x==r})})},function(r){throw f("Could not get events by name",r,{website_id:t,options:n})}))}catch(t){return Promise.reject(t)}},t.getMetrics=function(t,r){try{var e,i,o=this,u=s(null!=(e=null==r?void 0:r.period)?e:o.m),a=n({},r,{start_at:u.start_at,end_at:u.end_at,type:null!=(i=null==r?void 0:r.type)?i:o.P});return Promise.resolve(c(function(){return Promise.resolve(o.i.get("/website/"+t+"/metrics",{params:a})).then(function(t){return t.data})},function(r){throw f("Could not get metrics",r,{website_id:t,params:a})}))}catch(t){return Promise.reject(t)}},t.getActiveVisitors=function(t){try{var r=this;return Promise.resolve(c(function(){return Promise.resolve(r.i.get("/website/"+t+"/active")).then(function(t){return t.data})},function(r){throw f("Could not get active visitors",r,{website_id:t})}))}catch(t){return Promise.reject(t)}},t.createAccount=function(t){try{var r=this;return Promise.resolve(c(function(){return Promise.resolve(r.i.post("/account",t)).then(function(t){var n=t.data;return r.u?new d(r,n):n})},function(r){throw f("Could not create account",r,{options:t})}))}catch(t){return Promise.reject(t)}},t.updateAccount=function(t,r){try{var e=this;return Promise.resolve(c(function(){return Promise.resolve(e.i.post("/account",n({user_id:t},r))).then(function(t){var r=t.data;return e.u?new d(e,r):r})},function(n){throw f("Could not update account",n,{user_id:t,options:r})}))}catch(t){return Promise.reject(t)}},t.changePassword=function(t,r){try{var e=this;return Promise.resolve(c(function(){return Promise.resolve(e.i.post("/password",n({user_id:t},r))).then(function(t){var r=t.data;return e.u?new d(e,r):r})},function(n){throw f("Could not update password",n,{user_id:t,options:r})}))}catch(t){return Promise.reject(t)}},t.getAccounts=function(){try{var t=this;return Promise.resolve(c(function(){return Promise.resolve(t.i.get("/accounts")).then(function(r){var n=r.data;return t.u?n.map(function(r){return new d(t,r)}):n})},function(t){throw f("Could not get accounts",t)}))}catch(t){return Promise.reject(t)}},t.getAccount=function(t){try{var r=this;return Promise.resolve(c(function(){return Promise.resolve(r.i.get("/account/"+t)).then(function(t){var n=t.data;return r.u?new d(r,n):n})},function(r){throw f("Could not get account",r,{user_id:t})}))}catch(t){return Promise.reject(t)}},t.deleteAccount=function(t){try{var r=this;return Promise.resolve(c(function(){return Promise.resolve(r.i.delete("/account/"+t)).then(function(){})},function(r){throw f("Could not delete account",r,{user_id:t})}))}catch(t){return Promise.reject(t)}},e}();
//# sourceMappingURL=index.cjs.map
