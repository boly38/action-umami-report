import t from"axios";function r(){return r=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},r.apply(this,arguments)}var n=["1h","1hour","60min","60minutes"],e=["1d","1day","24h","24hours"],i=["7d","7days","1w","1week"],o=["31d","31days","1m","1month"],u=function(t){var r;if(void 0===t&&(t="24h"),n.includes(t))r=36e5;else if(e.includes(t))r=864e5;else if(i.includes(t))r=6048e5;else{if(!o.includes(t))throw"Unexpected period provided. Accepted values are : "+[].concat(n,e,i,o);r=26784e5}return{start_at:Date.now()-r,end_at:Date.now()}};function s(t,r){try{var n=t()}catch(t){return r(t)}return n&&n.then?n.then(void 0,r):n}var c="Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:102.0) Gecko/20100101 Firefox/102.0";function a(t,r,n){return n||(n="None specified"),n=JSON.stringify(n),r||(r="None specified"),r=r.toString(),new Error(t+"\nOptions: "+n+"\nStacktrace:"+r+"\n")}var f=/*#__PURE__*/function(){function t(t,r){this.t=void 0,this.id=void 0,this.websiteUuid=void 0,this.userId=void 0,this.name=void 0,this.domain=void 0,this.shareId=void 0,this.createdAt=void 0,this.t=t,Object.assign(this,r)}var r=t.prototype;return r.update=function(t){try{var r=this;return Promise.resolve(r.t.updateWebsite(r.websiteUuid,t)).then(function(t){return Object.assign(r,t),r})}catch(t){return Promise.reject(t)}},r.reset=function(){try{var t=this;return Promise.resolve(t.t.resetWebsite(t.websiteUuid)).then(function(){return t})}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.t.deleteWebsite(this.websiteUuid)).then(function(){})}catch(t){return Promise.reject(t)}},r.getStats=function(t){try{return Promise.resolve(this.t.getStats(this.websiteUuid,t))}catch(t){return Promise.reject(t)}},r.getPageviews=function(t){try{return Promise.resolve(this.t.getPageviews(this.websiteUuid,t))}catch(t){return Promise.reject(t)}},r.getEvents=function(t){try{return Promise.resolve(this.t.getEvents(this.websiteUuid,t))}catch(t){return Promise.reject(t)}},r.getMetrics=function(t){try{return Promise.resolve(this.t.getMetrics(this.websiteUuid,t))}catch(t){return Promise.reject(t)}},r.getActiveVisitors=function(){try{return Promise.resolve(this.t.getActiveVisitors(this.websiteUuid))}catch(t){return Promise.reject(t)}},t}(),h=/*#__PURE__*/function(){function t(t,r){this.t=void 0,this.id=void 0,this.username=void 0,this.isAdmin=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.accountUuid=void 0,this.t=t,Object.assign(this,r)}var r=t.prototype;return r.update=function(t){try{var r=this;return Promise.resolve(r.t.updateAccount(r.id,t)).then(function(t){return Object.assign(r,t),r})}catch(t){return Promise.reject(t)}},r.changePassword=function(t){try{var r=this;return Promise.resolve(r.t.changePassword(r.accountUuid,t)).then(function(){return r})}catch(t){return Promise.reject(t)}},r.deleteAccount=function(){try{return Promise.resolve(this.t.deleteAccount(this.id)).then(function(){})}catch(t){return Promise.reject(t)}},t}(),m=/*#__PURE__*/function(){var n=e.prototype;function e(r,n,e,i){if(this.i=void 0,this.o=void 0,this.u=void 0,this.h=Date.now(),this.m="24h",this.v="hour",this.l="America/Toronto",this.P="url",this.p=c,!r)throw new Error("A server hostname is required");if(r=r.replace(/https?:\/\//,"").replace(/\/$/,""),!n||!e)throw new Error("A username and a password are required");this.u=i,this.i=t.create({baseURL:"https://"+r+"/api",timeout:this.getClientTimeoutMs()}),this.i.interceptors.request.use(this.C.bind(this)),this.o=this.i.post("/auth/login",{username:n,password:e}).catch(function(t){throw a("Login failed",t,{server:r,username:n})})}return n.setDefaultPeriod=function(t){this.m=t},n.setDefaultUnit=function(t){this.v=t},n.setDefaultTZ=function(t){this.l=t},n.setDefaultMetricType=function(t){this.P=t},n.setDefaultUserAgent=function(t){this.p=t},n.getCurrentUser=function(){try{return Promise.resolve(this.o).then(function(t){return t.data.user})}catch(t){return Promise.reject(t)}},n.getClientTimeoutMs=function(){var t=parseInt(process.env.UMAMI_CLIENT_TIMEOUT_MS||2e3.toString());return t<100||t>6e4?2e3:t},n.C=function(t){try{var n=this;return"/auth/login"==t.url||"/collect"==t.url?Promise.resolve(t):Promise.resolve(n.o).then(function(e){if(t.headers=r({},t.headers,{Authorization:"Bearer "+e.data.token}),"/auth/verify"==t.url)return t;var i=function(){if(n.h+36e5<Date.now())return n.h=Date.now(),s(function(){return Promise.resolve(n.i.get("/auth/verify")).then(function(){})},function(r){throw a("Could not verify authentication",r,{axiosConfig:t})})}();return i&&i.then?i.then(function(r){return t}):t})}catch(t){return Promise.reject(t)}},n.collect=function(t,r,n){try{var e=this;return void 0===n&&(n=e.p),Promise.resolve(s(function(){if(!n)throw new Error("A user agent is required. See https://umami.is/docs/api");return Promise.resolve(e.i.post("/collect",{type:t,payload:r},{headers:{"User-Agent":n}})).then(function(t){return t.data})},function(e){throw a("Could not collect",e,{type:t,payload:r,userAgent:n})}))}catch(t){return Promise.reject(t)}},e.collect=function(r,n,e,i){void 0===i&&(i=c);try{return r=r.replace(/https?:\/\//,"").replace(/\/$/,""),Promise.resolve(s(function(){if(!i)throw new Error("A user agent is required. See https://umami.is/docs/api");return Promise.resolve(t.post("https://"+r+"/api/collect",{type:n,payload:e},{headers:{"User-Agent":i}})).then(function(t){return t.data})},function(t){throw a("Could not collect",t,{type:n,payload:e,userAgent:i})}))}catch(t){return Promise.reject(t)}},n.createWebsite=function(t){try{var n=this;return Promise.resolve(s(function(){function e(){return Promise.resolve(n.i.post("/websites",t)).then(function(t){var r=t.data;return n.u?new f(n,r):r})}var i=function(){if(!t.owner)return Promise.resolve(n.getCurrentUser()).then(function(n){t=r({},t,{owner:n.userId})})}();return i&&i.then?i.then(e):e()},function(r){throw a("Could not create website",r,{options:t})}))}catch(t){return Promise.reject(t)}},n.updateWebsite=function(t,n){try{var e=this;return Promise.resolve(s(function(){function i(){return Promise.resolve(e.i.post("/websites/"+t,n)).then(function(t){var r=t.data;return e.u?new f(e,r):r})}var o=function(){if(!n.owner)return Promise.resolve(e.getCurrentUser()).then(function(t){n=r({},n,{owner:t.userId})})}();return o&&o.then?o.then(i):i()},function(r){throw a("Could not update website",r,{websiteUuid:t,options:n})}))}catch(t){return Promise.reject(t)}},n.getWebsite=function(t){void 0===t&&(t=null);try{var r,n=this;return Promise.resolve(s(function(){function e(e){return r?e:Promise.resolve(n.i.get("/websites/"+t)).then(function(t){var r=t.data;return n.u?new f(n,r):r})}var i=function(){if(null==t)return Promise.resolve(n.getWebsites()).then(function(t){if(n.u){var e=new f(n,t[0]);return r=1,e}return r=1,t[0]})}();return i&&i.then?i.then(e):e(i)},function(r){throw a("Could not get website",r,{websiteUuid:t})}))}catch(t){return Promise.reject(t)}},n.getWebsiteBy=function(t,r){try{var n,e=function(e){var o;if(n)return e;function u(n){return o?n:Promise.resolve(i.getWebsites()).then(function(n){var e=n.find(function(n){return n[t]==r});if(!e)throw a("Could not find website",null,{key:t,value:r});return i.u?new f(i,e):e})}var c=function(){if("websiteUuid"==t)return s(function(){return Promise.resolve(i.getWebsite(r)).then(function(t){if(i.u){var r=new f(i,t);return o=1,r}return o=1,t})},function(n){throw a("Could not find website",n,{key:t,value:r})})}();return c&&c.then?c.then(u):u(c)},i=this,o=function(){if("shareId"==t)return s(function(){return Promise.resolve(i.i.get("/share/"+r)).then(function(t){return Promise.resolve(i.getWebsite(t.data.websiteId)).then(function(t){if(i.u){var r=new f(i,t);return n=1,r}return n=1,t})})},function(n){throw a("Could not find website",n,{key:t,value:r})})}();return Promise.resolve(o&&o.then?o.then(e):e(o))}catch(t){return Promise.reject(t)}},n.resetWebsite=function(t){try{var r=this;return Promise.resolve(s(function(){return Promise.resolve(r.i.post("/websites/"+t+"/reset")).then(function(t){var n=t.data;return r.u?new f(r,n):n})},function(r){throw a("Could not reset website",r,{websiteUuid:t})}))}catch(t){return Promise.reject(t)}},n.deleteWebsite=function(t){try{var r=this;return Promise.resolve(s(function(){return Promise.resolve(r.i.delete("/websites/"+t)).then(function(){})},function(r){throw a("Could not delete website",r,{websiteUuid:t})}))}catch(t){return Promise.reject(t)}},n.getWebsites=function(t){try{var r=this;return Promise.resolve(s(function(){return Promise.resolve(r.i.get("/websites",{params:t})).then(function(t){var n=t.data;return r.u?n.map(function(t){return new f(r,t)}):n})},function(r){throw a("Could not get websites",r,{options:t})}))}catch(t){return Promise.reject(t)}},n.getStats=function(t,n){try{var e,i=this,o=u(null!=(e=null==n?void 0:n.period)?e:i.m),c=r({},n,{start_at:o.start_at,end_at:o.end_at});return Promise.resolve(s(function(){return Promise.resolve(i.i.get("/websites/"+t+"/stats",{params:c})).then(function(t){return t.data})},function(r){throw a("Could not get stats",r,{websiteUuid:t,params:c})}))}catch(t){return Promise.reject(t)}},n.getPageviews=function(t,n){try{var e,i,o,c=this,f=u(null!=(e=null==n?void 0:n.period)?e:c.m),h=r({},n,{start_at:f.start_at,end_at:f.end_at,unit:null!=(i=null==n?void 0:n.unit)?i:c.v,tz:null!=(o=null==n?void 0:n.tz)?o:c.l});return Promise.resolve(s(function(){return Promise.resolve(c.i.get("/websites/"+t+"/pageviews",{params:h})).then(function(t){return t.data})},function(r){throw a("Could not get pageviews",r,{websiteUuid:t,params:h})}))}catch(t){return Promise.reject(t)}},n.getEvents=function(t,r){try{var n,e,i,o=this,c=u(null!=(n=null==r?void 0:r.period)?n:o.m),f={start_at:c.start_at,end_at:c.end_at,unit:null!=(e=null==r?void 0:r.unit)?e:o.v,tz:null!=(i=null==r?void 0:r.tz)?i:o.l,url:null==r?void 0:r.url,event_name:null==r?void 0:r.event_name};return Promise.resolve(s(function(){return Promise.resolve(o.i.get("/websites/"+t+"/events",{params:f})).then(function(t){return t.data})},function(r){throw a("Could not get events",r,{websiteUuid:t,params:f})}))}catch(t){return Promise.reject(t)}},n.getMetrics=function(t,n){try{var e,i,o=this,c=u(null!=(e=null==n?void 0:n.period)?e:o.m),f=r({},n,{start_at:c.start_at,end_at:c.end_at,type:null!=(i=null==n?void 0:n.type)?i:o.P});return Promise.resolve(s(function(){return Promise.resolve(o.i.get("/websites/"+t+"/metrics",{params:f})).then(function(t){return t.data})},function(r){throw a("Could not get metrics",r,{websiteUuid:t,params:f})}))}catch(t){return Promise.reject(t)}},n.getActiveVisitors=function(t){try{var r=this;return Promise.resolve(s(function(){return Promise.resolve(r.i.get("/websites/"+t+"/active")).then(function(t){return t.data})},function(r){throw a("Could not get active visitors",r,{websiteUuid:t})}))}catch(t){return Promise.reject(t)}},n.createAccount=function(t){try{var r=this;return Promise.resolve(s(function(){return Promise.resolve(r.i.post("/accounts",t)).then(function(t){var n=t.data;return r.u?new h(r,n):n})},function(r){throw a("Could not create account",r,{options:t})}))}catch(t){return Promise.reject(t)}},n.updateAccount=function(t,r){try{var n=this;return Promise.resolve(s(function(){return Promise.resolve(n.i.post("/accounts/"+t,r)).then(function(t){var r=t.data;return n.u?new h(n,r):r})},function(n){throw a("Could not update account",n,{userId:t,options:r})}))}catch(t){return Promise.reject(t)}},n.changePassword=function(t,r){try{var n=this;return Promise.resolve(s(function(){return Promise.resolve(n.i.post("/accounts/"+t+"/password",r)).then(function(t){var r=t.data;return n.u?new h(n,r):r})},function(n){throw a("Could not update password",n,{accountUuid:t,options:r})}))}catch(t){return Promise.reject(t)}},n.getAccounts=function(){try{var t=this;return Promise.resolve(s(function(){return Promise.resolve(t.i.get("/accounts")).then(function(r){var n=r.data;return t.u?n.map(function(r){return new h(t,r)}):n})},function(t){throw a("Could not get accounts",t)}))}catch(t){return Promise.reject(t)}},n.getAccount=function(t){try{var r=this;return Promise.resolve(s(function(){return Promise.resolve(r.i.get("/accounts/"+t)).then(function(t){var n=t.data;return r.u?new h(r,n):n})},function(r){throw a("Could not get account",r,{userId:t})}))}catch(t){return Promise.reject(t)}},n.deleteAccount=function(t){try{var r=this;return Promise.resolve(s(function(){return Promise.resolve(r.i.delete("/accounts/"+t)).then(function(){})},function(r){throw a("Could not delete account",r,{userId:t})}))}catch(t){return Promise.reject(t)}},e}();export{m as default};
//# sourceMappingURL=index.module.js.map
